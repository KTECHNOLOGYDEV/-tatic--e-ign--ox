<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Consultor FIPE - VS LOCAR</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'vs-black': '#080808',
            'vs-red': '#E60000',
            'vs-orange': '#FFA500',
            'vs-silver': '#D1D5DB',
          },
          animation: {
            'fade-in': 'fadeIn 0.5s ease-out',
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
          },
          keyframes: {
            fadeIn: { '0%': { opacity: 0, transform: 'translateY(12px)' }, '100%': { opacity: 1, transform: 'translateY(0)' } },
            pulse: { '0%, 100%' : { opacity: 1 }, '50%' : { opacity: 0.7 } }
          }
        }
      }
    }
  </script>
  <style>
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(rgba(8,8,8,0.92), rgba(8,8,8,0.97)), 
                  url('https://images.unsplash.com/photo-1503376780353-7e6692767b70?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80') center/cover no-repeat fixed;
      min-height: 100vh;
    }
    input {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      background-image: url("image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23E60000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
      background-position: right 0.75rem center;
      background-repeat: no-repeat;
      background-size: 1.25rem 1.25rem;
      padding-right: 2.25rem;
      transition: all 0.2s ease;
      border: 1px solid #333;
    }
    input:focus {
      border-color: #E60000;
      box-shadow: 0 0 0 2px rgba(230, 0, 0, 0.3);
    }
    .card-step {
      background: rgba(17, 24, 39, 0.85);
      border: 1px solid #333;
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 16px;
      transition: transform 0.2s, border-color 0.3s;
    }
    .card-step:hover {
      border-color: #E60000;
    }
    .step-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 26px;
      height: 26px;
      background: #E60000;
      color: white;
      border-radius: 50%;
      font-size: 12px;
      font-weight: bold;
      margin-right: 10px;
    }
    .pulse-btn {
      animation: pulse-slow 2s infinite;
    }
  </style>
</head>
<body class="text-white min-h-screen flex flex-col items-center py-5">
  <div class="container w-full max-w-md px-3 sm:max-w-lg">
    <div class="text-center mb-6">
      <div class="flex justify-center mb-3">
        <img 
          src="https://res.cloudinary.com/doro2qtjg/image/upload/v1759858465/f3957f_6ec81edc0ca14f898ac0bba8e4070e81-removebg-preview_zcdexk.png" 
          alt="VS LOCAR" 
          class="h-12 object-contain"
        />
      </div>
      <h1 class="text-xl font-bold text-white">Consultor FIPE</h1>
      <p class="text-vs-silver text-xs mt-1">Valor de mercado para locação e venda</p>
    </div>

    <div class="card-step">
      <div class="flex items-center mb-2">
        <span class="step-number">1</span>
        <label class="text-vs-silver text-sm font-medium">Consultar por Placa</label>
      </div>
      <input 
        type="text" 
        id="placa" 
        maxlength="7" 
        placeholder="Ex: ABC1234 ou ABC1D23" 
        class="w-full p-2.5 bg-gray-800/70 border border-gray-700 rounded-lg focus:ring-2 focus:ring-vs-red focus:border-vs-red focus:outline-none text-white text-sm"
      />
      <p class="text-xs text-gray-500 mt-1">Placa sem espaços ou traços</p>
    </div>

    <div id="resultado" class="hidden mt-5 p-4 bg-gradient-to-r from-red-900/40 to-black rounded-lg border border-vs-red/40">
      <div class="text-center">
        <p class="text-vs-orange font-bold text-lg" id="valorFipe">R$ --</p>
        <p class="text-vs-silver text-sm mt-1" id="descricaoFipe">—</p>
        <p class="text-xs text-gray-500 mt-2">Dados oficiais FIPE • Atualizados mensalmente</p>
      </div>
    </div>

    <div class="mt-5 text-center">
      <button id="btnConsultar" class="pulse-btn bg-vs-red hover:bg-red-700 text-white font-semibold py-3.5 px-6 rounded-full transition shadow-lg hover:shadow-xl flex items-center justify-center mx-auto gap-2">
        <i class="fas fa-search"></i>
        <span>Consultar Valor FIPE</span>
      </button>
    </div>

    <div id="erro" class="hidden mt-4 text-red-400 text-center text-sm px-2 py-2 rounded bg-red-900/20"></div>
    <div id="loading" class="hidden mt-4 text-center">
      <div class="inline-block w-6 h-6 border-2 border-vs-red border-t-transparent rounded-full animate-spin"></div>
      <p class="text-vs-silver mt-2 text-sm">Consultando dados oficiais...</p>
    </div>
  </div>

  <div class="mt-6 text-center max-w-md px-2">
    <p class="text-gray-500 text-xs">
      Desenvolvido por <span class="text-vs-orange font-medium">Kelvin Batista</span>
    </p>
  </div>

  <script>
    const el = {
      placa: document.getElementById('placa'),
      btn: document.getElementById('btnConsultar'),
      resultado: document.getElementById('resultado'),
      valor: document.getElementById('valorFipe'),
      desc: document.getElementById('descricaoFipe'),
      erro: document.getElementById('erro'),
      loading: document.getElementById('loading')
    };

    el.placa.addEventListener('input', (e) => {
      let v = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
      if (v.length > 7) v = v.slice(0, 7);
      e.target.value = v;
    });

    el.btn.addEventListener('click', async () => {
      const placa = el.placa.value.trim().replace(/[^A-Z0-9]/g, '').toUpperCase();
      if (!placa || placa.length !== 7) {
        mostrarErro('⚠️ Digite uma placa válida (7 caracteres)');
        return;
      }

      toggleLoading(true);
      esconderErro();
      el.resultado.classList.add('hidden');

      try {
        const res = await fetch(`/api/placa?placa=${placa}`);
        const data = await res.json();

        if (!res.ok) throw new Error(data.error || 'Erro desconhecido');

        el.valor.textContent = data.valor || 'R$ —';
        el.desc.textContent = `${data.marca || '—'} ${data.modelo || '—'} - ${data.ano_modelo || '—'} (${data.combustivel || '—'})`;
        el.resultado.classList.remove('hidden');

      } catch (err) {
        mostrarErro(`⚠️ ${err.message}`);
      } finally {
        toggleLoading(false);
      }
    });

    function toggleLoading(show) {
      el.loading.classList.toggle('hidden', !show);
      el.btn.disabled = show;
    }

    function mostrarErro(msg) {
      el.erro.textContent = msg;
      el.erro.classList.remove('hidden');
      setTimeout(() => el.erro.classList.add('hidden'), 7000);
    }

    function esconderErro() {
      el.erro.classList.add('hidden');
    }
  </script>
</body>
</html>

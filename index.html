<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EmpreendaCheck - Consulta de CNPJ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/heroicons@1.0.1/dist/outline.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(-45deg, #009C3B, #FFDF00, #0070AD, #FFDF00, #009C3B);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
    }
    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .br-flag-gradient {
      background: linear-gradient(135deg, #009C3B 0%, #FFDF00 100%);
    }
    .section-divider {
      @apply border-t border-gray-200 my-6;
    }
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 50;
      color: white;
      font-size: 1.2rem;
    }
    .loading-overlay.hidden {
      display: none;
    }
    .data-card {
      @apply bg-white/90 p-5 rounded-xl shadow-md border border-gray-100 transition-all duration-300 hover:shadow-lg;
    }
    .data-item {
      @apply p-3 bg-gray-50/80 rounded-lg border border-gray-200 transition-opacity duration-200;
    }
    .fade-in {
      animation: fadeIn 0.5s ease-out forwards;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    /* Estilo oculto para PDF */
    #pdfContent {
      display: none;
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen flex flex-col">
  <!-- Overlay de Loading -->
  <div id="loadingOverlay" class="loading-overlay hidden">
    <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-white mb-4"></div>
    <p>Consultando dados...</p>
  </div>

  <header class="br-flag-gradient text-white shadow-lg sticky top-0 z-40">
    <div class="container mx-auto px-4 py-6 flex flex-col items-center">
      <h1 class="text-3xl md:text-4xl font-bold">EmpreendaCheck</h1>
      <p class="mt-2 text-center text-lg">Consulta de CNPJ em tempo real</p>
    </div>
  </header>

  <main class="container mx-auto px-4 py-8 flex-grow">
    <div class="max-w-4xl mx-auto">
      <div class="bg-white/90 backdrop-blur-sm rounded-xl shadow-lg p-6 mb-6 transition-all duration-300 hover:shadow-xl">
        <div class="mb-6">
          <label for="cnpjInput" class="block text-lg font-medium text-gray-700">Digite o CNPJ</label>
          <div class="flex mt-2">
            <input
              type="text"
              id="cnpjInput"
              placeholder="00.000.000/0000-00"
              class="w-full px-4 py-3 border border-gray-300 rounded-l-lg focus:ring-2 focus:ring-blue-500 focus:outline-none transition"
            />
            <button
              id="searchBtn"
              class="bg-blue-600 hover:bg-blue-700 text-white px-6 rounded-r-lg font-semibold transition flex items-center justify-center"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
              </svg>
              Buscar
            </button>
          </div>
        </div>

        <div id="loading" class="hidden flex justify-center py-6">
          <div class="animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-blue-500"></div>
        </div>

        <div id="error" class="mt-6 hidden text-red-500 bg-red-50 p-4 rounded-lg">
          <p id="errorMsg"></p>
        </div>
      </div>

      <div id="result" class="mt-6 hidden">
        <!-- Botão para exportar PDF -->
        <div class="mb-6 text-right">
          <button id="exportPdfBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-semibold transition flex items-center justify-center mx-auto md:mx-0">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
            </svg>
            Exportar PDF
          </button>
        </div>

        <!-- Dados Principais -->
        <div class="data-card fade-in mb-6">
          <h2 class="text-xl font-bold mb-4 text-gray-800">Dados da Empresa</h2>
          <div id="dadosPrincipais" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Será preenchido dinamicamente -->
          </div>
        </div>

        <div class="section-divider"></div>

        <!-- Sócios -->
        <div id="qsaCard" class="data-card fade-in mb-6">
          <h2 class="text-xl font-bold mb-4 text-gray-800">Quadro de Sócios (QSA)</h2>
          <div id="qsa" class="space-y-2">
            <!-- Será preenchido dinamicamente -->
          </div>
        </div>

        <div class="section-divider"></div>

        <!-- CNAEs Secundários -->
        <div id="cnaesCard" class="data-card fade-in mb-6">
          <h2 class="text-xl font-bold mb-4 text-gray-800">CNAEs Secundários</h2>
          <ul id="cnaes_secundarios" class="list-disc pl-5 space-y-1">
            <!-- Será preenchido dinamicamente -->
          </ul>
        </div>

        <div class="section-divider"></div>

        <!-- Regime Tributário -->
        <div id="regimeCard" class="data-card fade-in mb-6">
          <h2 class="text-xl font-bold mb-4 text-gray-800">Regime Tributário</h2>
          <ul id="regime_tributario" class="list-disc pl-5 space-y-1">
            <!-- Será preenchido dinamicamente -->
          </ul>
        </div>

        <div class="section-divider"></div>

        <!-- Outras Informações -->
        <div id="outrasInfoCard" class="data-card fade-in">
          <h2 class="text-xl font-bold mb-4 text-gray-800">Outras Informações</h2>
          <div id="outrasInfo" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Será preenchido dinamicamente -->
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Conteúdo oculto para exportação em PDF -->
  <div id="pdfContent" class="p-6 max-w-4xl mx-auto bg-white text-gray-800">
    <h1 class="text-3xl font-bold mb-2">EmpreendaCheck - Dados da Empresa</h1>
    <hr class="my-4">
    <div id="pdfDados"></div>
  </div>

  <footer class="py-6 text-center text-gray-600 bg-white/90 mt-8 border-t">
    <p>© EmpreendaCheck - Todos os direitos reservados</p>
  </footer>

  <script>
    function validarCNPJ(cnpj) {
      cnpj = cnpj.replace(/[^\d]/g, '');
      if (cnpj.length !== 14 || /^(\d)\1+$/.test(cnpj)) return false;

      let tamanho = cnpj.length - 2;
      let numeros = cnpj.substring(0, tamanho);
      let digitos = cnpj.substring(tamanho);
      let soma = 0;
      let pos = tamanho - 7;

      for (let i = tamanho; i >= 1; i--) {
        soma += numeros.charAt(tamanho - i) * pos--;
        if (pos < 2) pos = 9;
      }

      let resultado = soma % 11 < 2 ? 0 : 11 - (soma % 11);
      if (resultado !== parseInt(digitos.charAt(0))) return false;

      tamanho = tamanho + 1;
      numeros = cnpj.substring(0, tamanho);
      soma = 0;
      pos = tamanho - 7;

      for (let i = tamanho; i >= 1; i--) {
        soma += numeros.charAt(tamanho - i) * pos--;
        if (pos < 2) pos = 9;
      }

      resultado = soma % 11 < 2 ? 0 : 11 - (soma % 11);
      return resultado === parseInt(digitos.charAt(1));
    }

    // Função para converter número para extenso (até quadrilhões)
    function numeroParaExtenso(numero) {
      const unidades = ["", " e um", " e dois", " e três", " e quatro", " e cinco", " e seis", " e sete", " e oito", " e nove"];
      const dezenas = ["", "", "vinte", "trinta", "quarenta", "cinquenta", "sessenta", "setenta", "oitenta", "noventa"];
      const centenas = ["", "cento", "duzentos", "trezentos", "quatrocentos", "quinhentos", "seiscentos", "setecentos", "oitocentos", "novecentos"];
      const especiais = ["dez", "onze", "doze", "treze", "quatorze", "quinze", "dezesseis", "dezessete", "dezoito", "dezenove"];

      function converteAteMil(num) {
        if (num === 0) return "zero";
        let resultado = "";

        if (num >= 100) {
          if (num === 100) resultado += "cem";
          else resultado += centenas[Math.floor(num / 100)];
          num %= 100;
          if (num > 0) resultado += " ";
        }

        if (num >= 10 && num <= 19) {
          resultado += especiais[num - 10];
          num = 0;
        } else if (num >= 20) {
          resultado += dezenas[Math.floor(num / 10)];
          num %= 10;
          if (num > 0) resultado += unidades[num];
        } else if (num > 0) {
          resultado += unidades[num];
        }
        return resultado.trim();
      }

      if (numero === 0) return converteAteMil(0);

      let resultado = "";
      const partes = [];
      let escala = ["", " mil", " milhões", " bilhões", " trilhões", " quadrilhões"];

      // Divide o número em grupos de 3 dígitos da direita para a esquerda
      let numStr = Math.floor(numero).toString();
      while (numStr.length > 0) {
        partes.unshift(numStr.slice(-3));
        numStr = numStr.slice(0, -3);
      }

      for (let i = 0; i < partes.length; i++) {
        const grupo = parseInt(partes[i]);
        if (grupo > 0) {
          let grupoExtenso = converteAteMil(grupo);
          let sufixo = escala[partes.length - 1 - i];

          if (sufixo) {
            if (grupo === 1 && sufixo === " milhões") grupoExtenso = "um milhão";
            else if (grupo === 1 && sufixo === " bilhões") grupoExtenso = "um bilhão";
            else if (grupo === 1 && sufixo === " trilhões") grupoExtenso = "um trilhão";
            else if (grupo === 1 && sufixo === " quadrilhões") grupoExtenso = "um quadrilhão";
            else if (grupo === 1 && sufixo === " mil") grupoExtenso = "mil";
            else grupoExtenso += sufixo;
          }
          if (resultado) resultado += ", ";
          resultado += grupoExtenso;
        }
      }

      // Parte decimal (centavos)
      const centavos = Math.round((numero - Math.floor(numero)) * 100);
      if (centavos > 0) {
        const centavosExtenso = converteAteMil(centavos);
        if (centavos === 1) {
          resultado += " reais e " + centavosExtenso + " centavo";
        } else {
          resultado += " reais e " + centavosExtenso + " centavos";
        }
      } else {
        resultado += " reais";
      }

      return resultado.charAt(0).toUpperCase() + resultado.slice(1);
    }


    document.addEventListener("DOMContentLoaded", () => {
      const input = document.getElementById("cnpjInput");
      const searchBtn = document.getElementById("searchBtn");
      const resultDiv = document.getElementById("result");
      const errorDiv = document.getElementById("error");
      const loadingOverlay = document.getElementById("loadingOverlay");
      const exportBtn = document.getElementById("exportPdfBtn");
      const pdfDadosDiv = document.getElementById("pdfDados");

      input.addEventListener("input", (e) => {
        let v = e.target.value.replace(/\D/g, "");
        if (v.length > 14) v = v.substring(0, 14);
        if (v.length > 12) v = v.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/, "$1.$2.$3/$4-$5");
        else if (v.length > 8) v = v.replace(/(\d{2})(\d{3})(\d{3})(\d{4})/, "$1.$2.$3/$4");
        else if (v.length > 5) v = v.replace(/(\d{2})(\d{3})(\d{3})/, "$1.$2.$3/");
        else if (v.length > 2) v = v.replace(/(\d{2})(\d{3})/, "$1.$2.");
        e.target.value = v;
      });

      const fetchCNPJ = async (cnpj) => {
        cnpj = cnpj.replace(/[^\d]/g, "");
        if (!validarCNPJ(cnpj)) {
          showError("CNPJ inválido. Verifique os dígitos.");
          return;
        }

        try {
          loadingOverlay.classList.remove("hidden");
          errorDiv.classList.add("hidden");
          resultDiv.classList.add("hidden");

          const response = await fetch(`https://brasilapi.com.br/api/cnpj/v1/${cnpj}`);
          const data = await response.json();

          if (data.erro) {
            showError("CNPJ não encontrado.");
            return;
          }

          fillResult(data);
          resultDiv.classList.remove("hidden");
        } catch (err) {
          console.error(err);
          showError("Erro ao buscar dados. Tente novamente.");
        } finally {
          loadingOverlay.classList.add("hidden");
        }
      };

      const showError = (msg) => {
        document.getElementById("errorMsg").textContent = msg;
        errorDiv.classList.remove("hidden");
      };

      const fillResult = (data) => {
        const dadosPrincipais = document.getElementById("dadosPrincipais");
        const qsaDiv = document.getElementById("qsa");
        const cnaesList = document.getElementById("cnaes_secundarios");
        const regimeList = document.getElementById("regime_tributario");
        const outrasInfo = document.getElementById("outrasInfo");

        // Limpar conteúdo anterior
        dadosPrincipais.innerHTML = "";
        qsaDiv.innerHTML = "";
        cnaesList.innerHTML = "";
        regimeList.innerHTML = "";
        outrasInfo.innerHTML = "";

        // Dados principais
        const camposPrincipais = [
          { label: "Razão Social", value: data.razao_social },
          { label: "Nome Fantasia", value: data.nome_fantasia },
          { label: "CNPJ", value: formatCNPJ(data.cnpj) },
          { label: "UF", value: data.uf },
          { label: "Município", value: data.municipio },
          { label: "Logradouro", value: `${data.descricao_tipo_de_logradouro || ''} ${data.logradouro || ''}`.trim() },
          { label: "Número", value: data.numero },
          { label: "Complemento", value: data.complemento },
          { label: "Bairro", value: data.bairro },
          { label: "CEP", value: data.cep },
          { label: "Telefone", value: data.ddd_telefone_1 ? `(${data.ddd_telefone_1}) ${data.telefone_1 || ''}` : null },
          { label: "Email", value: data.email },
          { label: "Situação Cadastral", value: data.descricao_situacao_cadastral },
          { label: "Data de Início de Atividade", value: data.data_inicio_atividade },
          { label: "Porte", value: data.porte },
          { label: "Natureza Jurídica", value: data.natureza_juridica },
          { label: "CNAE Fiscal", value: data.cnae_fiscal },
          { label: "CNAE Fiscal Descrição", value: data.cnae_fiscal_descricao },
        ];

        camposPrincipais.forEach(campo => {
          if (campo.value) {
            const div = document.createElement("div");
            div.classList.add("data-item");
            div.innerHTML = `<span class="font-semibold">${campo.label}:</span> <span>${campo.value}</span>`;
            dadosPrincipais.appendChild(div);
          }
        });

        // Sócios
        if (data.qsa && data.qsa.length > 0) {
          data.qsa.forEach(socio => {
            const p = document.createElement("p");
            p.classList.add("data-item");
            p.textContent = `${socio.nome_socio} - ${socio.qualificacao_socio} (${socio.faixa_etaria})`;
            qsaDiv.appendChild(p);
          });
          document.getElementById("qsaCard").style.display = "block";
        } else {
          document.getElementById("qsaCard").style.display = "none";
        }

        // CNAEs Secundários
        if (data.cnaes_secundarios && data.cnaes_secundarios.length > 0) {
          data.cnaes_secundarios.forEach(cnae => {
            const li = document.createElement("li");
            li.classList.add("data-item");
            li.textContent = `${cnae.codigo} - ${cnae.descricao}`;
            cnaesList.appendChild(li);
          });
          document.getElementById("cnaesCard").style.display = "block";
        } else {
          document.getElementById("cnaesCard").style.display = "none";
        }

        //
